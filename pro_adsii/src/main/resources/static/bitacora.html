<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Bitácora de Acceso</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
    <h2 class="mb-4 text-center">Bitácora de Acceso</h2>

    <div class="card">
        <div class="card-header">
            <h5>Registros</h5>
        </div>
        <div class="card-body">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Usuario</th>
                    <th>Tipo Acceso</th>
                    <th>Acción</th>
                    <th>Fecha</th>
                    <th>IP</th>
                    <th>Navegador</th>
                    <th>Sistema Operativo</th>
                    <th>Dispositivo</th>
                    <th>Sesión</th>
                </tr>
                </thead>
                <tbody id="bitacora-body">
                <tr><td colspan="10" class="text-center">Cargando...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    async function cargarBitacora() {
        const response = await fetch("/bitacora/listar");
        const data = await response.json();

        const tbody = document.getElementById("bitacora-body");
        tbody.innerHTML = "";

        if (data.length === 0) {
            tbody.innerHTML = `<tr><td colspan="10" class="text-center">No hay registros en la bitácora.</td></tr>`;
            return;
        }

        data.forEach(b => {
            let tipoAcceso = "Otro";
            if (b.idTipoAcceso === 1) tipoAcceso = '<span class="badge bg-success">Acceso Concedido</span>';
            else if (b.idTipoAcceso === 2) tipoAcceso = '<span class="badge bg-danger">Bloqueado</span>';
            else if (b.idTipoAcceso === 3) tipoAcceso = '<span class="badge bg-warning">Usuario Inactivo</span>';
            else if (b.idTipoAcceso === 4) tipoAcceso = '<span class="badge bg-secondary">No Existe</span>';

            const row = `
                <tr>
                    <td>${b.idBitacoraAcceso}</td>
                    <td>${b.idUsuario}</td>
                    <td>${tipoAcceso}</td>
                    <td>${b.accion ?? ""}</td>
                    <td>${b.fechaAcceso ? new Date(b.fechaAcceso).toLocaleString() : ""}</td>
                    <td>${b.direccionIp ?? ""}</td>
                    <td>${b.browser ?? ""}</td>
                    <td>${b.sistemaOperativo ?? ""}</td>
                    <td>${b.dispositivo ?? ""}</td>
                    <td>${b.sesion ?? "—"}</td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    cargarBitacora();
</script>
</body>
</html>
