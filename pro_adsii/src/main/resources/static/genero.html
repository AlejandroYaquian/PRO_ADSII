<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CRUD Género</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">

<h2 class="mb-4">Gestión de Géneros</h2>

<!-- Formulario Crear/Editar -->
<div class="card mb-4">
    <div class="card-header">
        <h5 id="form-title">Nuevo Género</h5>
    </div>
    <div class="card-body">
        <form id="genero-form">
            <input type="hidden" id="idGenero">
            <div class="mb-3">
                <label for="nombre" class="form-label">Nombre</label>
                <input type="text" id="nombre" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="usuarioCreacion" class="form-label">Usuario Creación</label>
                <input type="text" id="usuarioCreacion" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-success">Guardar</button>
            <button type="button" id="cancelar" class="btn btn-secondary">Cancelar</button>
        </form>
    </div>
</div>

<!-- Tabla de Géneros -->
<table class="table table-bordered table-striped">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Fecha Creación</th>
            <th>Usuario Creación</th>
            <th>Fecha Modificación</th>
            <th>Usuario Modificación</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody id="generos-table"></tbody>
</table>

<script>
const apiBase = '/genero';

async function listarGeneros() {
    const res = await fetch(`${apiBase}/listar`);
    const generos = await res.json();
    const tbody = document.getElementById('generos-table');
    tbody.innerHTML = '';
    generos.forEach(g => {
        tbody.innerHTML += `
            <tr>
                <td>${g.idGenero}</td>
                <td>${g.nombre}</td>
                <td>${g.fechaCreacion || ''}</td>
                <td>${g.usuarioCreacion || ''}</td>
                <td>${g.fechaModificacion || ''}</td>
                <td>${g.usuarioModificacion || ''}</td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editarGenero(${g.idGenero})">Editar</button>
                    <button class="btn btn-danger btn-sm" onclick="eliminarGenero(${g.idGenero})">Eliminar</button>
                </td>
            </tr>
        `;
    });
}

document.getElementById('genero-form').addEventListener('submit', async e => {
    e.preventDefault();
    const idGenero = document.getElementById('idGenero').value;
    const nombre = document.getElementById('nombre').value;
    const usuarioCreacion = document.getElementById('usuarioCreacion').value;

    await fetch(`${apiBase}/guardar`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            idGenero: idGenero || null,
            nombre,
            usuarioCreacion
        })
    });

    document.getElementById('genero-form').reset();
    document.getElementById('form-title').innerText = 'Nuevo Género';
    listarGeneros();
});

async function editarGenero(id) {
    const res = await fetch(`${apiBase}/${id}`);
    const g = await res.json();
    document.getElementById('idGenero').value = g.idGenero;
    document.getElementById('nombre').value = g.nombre;
    document.getElementById('usuarioCreacion').value = g.usuarioCreacion || '';
    document.getElementById('form-title').innerText = 'Editar Género';
}

async function eliminarGenero(id) {
    if(confirm('¿Seguro que deseas eliminar este género?')) {
        await fetch(`${apiBase}/eliminar/${id}`, { method: 'DELETE' });
        listarGeneros();
    }
}

document.getElementById('cancelar').addEventListener('click', () => {
    document.getElementById('genero-form').reset();
    document.getElementById('idGenero').value = '';
    document.getElementById('form-title').innerText = 'Nuevo Género';
});

listarGeneros();
</script>

</body>
</html>
